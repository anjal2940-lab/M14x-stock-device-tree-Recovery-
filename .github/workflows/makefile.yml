      - name: Fix DTB Folder Structure and BoardConfig
        run: |
          # Define the path to your device tree
          DEV_PATH="device/samsung/m14x"
          
          echo "Step 1: Creating prebuilt/dtb directory..."
          mkdir -p $DEV_PATH/prebuilt/dtb
          
          echo "Step 2: Moving prebuilt files to correct locations..."
          # Move dtb.img into the new folder if it exists in the root of prebuilt
          if [ -f "$DEV_PATH/prebuilt/dtb.img" ]; then
            mv $DEV_PATH/prebuilt/dtb.img $DEV_PATH/prebuilt/dtb/dtb.img
            echo "Moved dtb.img to $DEV_PATH/prebuilt/dtb/"
          fi
          
          echo "Step 3: Updating BoardConfig.mk variables..."
          # Remove any existing DTB variable lines to prevent duplicates
          sed -i '/TARGET_PREBUILT_DTB/d' $DEV_PATH/BoardConfig.mk
          sed -i '/BOARD_PREBUILT_DTBIMAGE_DIR/d' $DEV_PATH/BoardConfig.mk
          
          # Add the correct directory variable
          # We use the DTBIMAGE_DIR variable which Ninja expects for prebuilt DTBs
          echo "BOARD_PREBUILT_DTBIMAGE_DIR := \$(DEVICE_PATH)/prebuilt/dtb" >> $DEV_PATH/BoardConfig.mk
          
          # Ensure the inclusion flag is set
          if ! grep -q "BOARD_INCLUDE_DTB_IN_BOOTIMG" $DEV_PATH/BoardConfig.mk; then
            echo "BOARD_INCLUDE_DTB_IN_BOOTIMG := true" >> $DEV_PATH/BoardConfig.mk
          fi

          echo "Fix applied successfully. Current BoardConfig Kernel Section:"
          grep -E "DTB|KERNEL" $DEV_PATH/BoardConfig.mk
