name: Standardize Device Tree

on:
  workflow_dispatch: # Allows you to run this manually

jobs:
  format-tree:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Source
        uses: actions/checkout@v4

      - name: Create Standard Structure
        run: |
          # 1. Create a workspace for the new structure
          mkdir -p output/device/samsung/m14x
          
          # 2. Copy files from your deep extracted path to the standard root
          # Note: We copy the content of the m14x folder, not the folder itself
          cp -r extracted/stock_tree/samsung/m14x/* output/device/samsung/m14x/
          
          # 3. Fix Internal Makefiles (sed logic)
          cd output/device/samsung/m14x/
          find . -type f -name "*.mk" -exec sed -i 's|device/samsung/m14x/extracted/stock_tree/samsung/m14x|device/samsung/m14x|g' {} +
          
          # 4. Verify the new layout
          echo "New standardized structure:"
          ls -R

      - name: Push to Standardized Branch
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./output/device/samsung/m14x
          publish_branch: standardized-tree # This creates a new branch with JUST the clean files
          commit_message: "Standardize tree structure for PBRP/TWRP build"
